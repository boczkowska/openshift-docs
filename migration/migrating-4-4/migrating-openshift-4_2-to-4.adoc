[id="migrating-openshift-4_2-to-4"]
= Migrating between {product-title} 4.2 clusters
include::modules/common-attributes.adoc[]
:context: ocp-4_2-4_2
:ocp-4_2-4_2:

toc::[]

You can migrate application workloads between {product-title} 4.2 clusters with the Cluster Application Migration (CAM) tool. The CAM tool enables you to control the migration and to minimize application downtime.

The CAM tool's web console and API, based on Kubernetes custom resources, enable you to migrate stateful and stateless application workloads at the granularity of a namespace.

.Prerequisites

* You must have xref:../../cli_reference/openshift_cli/administrator-cli-commands.html#policy[`cluster-admin` privileges] on all clusters.
* You must have a replication repository that supports the S3 API and is accessible to the source and target clusters.

include::modules/migration-understanding-cam.adoc[leveloffset=+1]

[id='Configuring-replication-repository_{context}']
== Configuring a replication repository

You must configure a replication repository. The CAM tool uses the replication repository as a temporary intermediate storage space for copying data from the source cluster to the target cluster, using the xref:migration-understanding-data-copy-methods_{context}[file system or snapshot copy method].

// * xref:migration-configuring-noobaa_{context}[NooBaa] or other generic S3 storage provider (does not support the snapshot copy method)
* Multi Cloud Gateway (MCG) or other generic S3 storage provider
+
MCG is installed by the CAM Operator and does not support the snapshot copy method.

* xref:migration-configuring-aws-s3_{context}[AWS S3]
* xref:migration-configuring-gcp_{context}[Google Cloud Provider]
* xref:migration-configuring-azure_{context}[Microsoft Azure]

include::modules/migration-understanding-data-copy-methods.adoc[leveloffset=+2]
// include::modules/migration-configuring-noobaa.adoc[leveloffset=+2]
include::modules/migration-configuring-aws-s3.adoc[leveloffset=+2]
include::modules/migration-configuring-gcp.adoc[leveloffset=+2]
include::modules/migration-configuring-azure.adoc[leveloffset=+2]
:ocp-4_2-4_2!:

== Deploying the Cluster Application Migration tool

Deploying the CAM tool involves the following steps:

. Installing the CAM Operator  on the xref:installing-cam-operator-ocp-4_sourcecluster-4_2-4_2[source] and xref:installing-cam-operator-ocp-4_targetcluster-4_2-4_2[target] clusters
. Configuring cross-origin resource sharing on the xref:migration-configuring-cors-4_sourcecluster-4_2-4_2[source cluster]

:context: sourcecluster-4_2-4_2
:sourcecluster-4_2-4_2:
include::modules/migration-installing-cam-operator-ocp-4.adoc[leveloffset=+2]
:sourcecluster-4_2-4_2!:

:context: targetcluster-4_2-4_2
:targetcluster-4_2-4_2:
include::modules/migration-installing-cam-operator-ocp-4.adoc[leveloffset=+2]
:targetcluster-4_2-4_2!:

:context: sourcecluster-4_2-4_2
:sourcecluster-4_2-4_2:
include::modules/migration-configuring-cors-4.adoc[leveloffset=+2]
:sourcecluster-4_2-4_2!:


:context: ocp-4_2-4_2
:ocp-4_2-4_2:
== Migrating applications with the CAM web console

include::modules/migration-launching-cam.adoc[leveloffset=+2]
include::modules/migration-adding-cluster-to-cam.adoc[leveloffset=+2]
include::modules/migration-adding-replication-repository-to-cam.adoc[leveloffset=+2]
include::modules/migration-changing-migration-plan-limits.adoc[leveloffset=+2]
include::modules/migration-creating-migration-plan-cam.adoc[leveloffset=+2]
include::modules/migration-running-migration-plan-cam.adoc[leveloffset=+2]

== Troubleshooting a failed migration

You can view the migration custom resources (CRs) and download logs to troubleshoot a failed migration.

include::modules/migration-custom-resources.adoc[leveloffset=+2]
include::modules/migration-viewing-migration-crs.adoc[leveloffset=+2]
include::modules/migration-downloading-logs.adoc[leveloffset=+2]
include::modules/migration-restic-timeout.adoc[leveloffset=+2]

include::modules/migration-known-issues.adoc[leveloffset=+1]
:ocp-4_2-4_2!:
